@page "/Administration/Users"
@inherits BasePage
@inject HttpClient Http
@inject AppState State

@if (UserData != null)
{
    <Table TableData="@UserData">
        <td>
            @if (context.Active && context.ExpirationDate == null)
            {
                <i class="bi bi-person-fill success-light"></i>
            }
            else if (context.Active && context.ExpirationDate != null)
            {
                <i class="bi bi-person-fill warning-light"></i>
            }
            else 
            {
                <i class="bi bi-person-fill-slash error-light"></i>
            }
        </td>
        <td>@context.Username</td>
        <td>@context.Name</td>
        <td>@context.Email</td>
        <td>@context.RoleName</td>
        <td>
            <i class="bi bi-person-fill-gear"></i>
            <i class="bi bi-person-fill-lock"></i>
            <i class="bi bi-person-fill-x"></i>
        </td>
    </Table>
}
else
{
    <LoadingSpinner />
}

@code {
    private List<TableHeaderData> TableHeaders = new() {
        new TableHeaderData { Content = "State" },
        new TableHeaderData { Content = "Username" },
        new TableHeaderData { Content = "Name" },
        new TableHeaderData { Content = "E-Mail" },
        new TableHeaderData { Content = "Role" },
        new TableHeaderData { Content = "Actions" },
    };

    private TableData<User>? UserData;

    protected override async Task OnInitializedAsync()
    {
        if (!await CheckLoginNavigateAsync())        
            return;

        Console.WriteLine(System.Text.Json.JsonSerializer.Serialize(State.User));
        var response = await Http.PostAsJsonAsync<RequestBase>(
            "Administration/Users/GetAll", new RequestBase
            {
                Token = State.User?.Token,
                UserId = State.User?.UserId
            });

        var result = await response.Content.ReadFromJsonAsync<GenericRepsonse<List<User>>>();

        UserData = new(TableHeaders, result.Value);
    }
}